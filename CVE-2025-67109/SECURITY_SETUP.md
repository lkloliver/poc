# Cyclone DDS Security Configuration Guide

This document explains how to configure DDS security measures according to the [Cyclone DDS Official Documentation](https://cyclonedds.io/docs/cyclonedds/latest/security/example_configuration.html).

## Configuration Steps

### 1. Run Security Configuration Script

Run the `setup_security.sh` script to automatically generate all required certificates and configuration files:

```bash
cd /home/svf/cyclonedds_security_test
./setup_security.sh
```

This script will execute the following steps:

1. **Create Identity CA (Identity CA)**
   - Generate `example_id_ca_priv_key.pem` - Identity CA private key
   - Generate `example_id_ca_cert.pem` - Identity CA certificate

2. **Create Permissions CA (Permissions CA)**
   - Generate `example_perm_ca_priv_key.pem` - Permissions CA private key
   - Generate `example_perm_ca_cert.pem` - Permissions CA certificate

3. **Create Publisher Identity Certificate**
   - Generate `example_publisher_priv_key.pem` - Publisher private key
   - Generate `example_publisher_cert.pem` - Publisher identity certificate (signed by Identity CA)

4. **Create Subscriber Identity Certificate**
   - Generate `example_subscriber_priv_key.pem` - Subscriber private key
   - Generate `example_subscriber_cert.pem` - Subscriber identity certificate (signed by Identity CA)

5. **Create and Sign Governance Document**
   - Generate `example_governance.xml` - Governance document (plaintext)
   - Generate `example_governance.p7s` - Signed governance document (signed by Permissions CA)

6. **Create and Sign Permissions Documents**
   - Generate `example_publisher_permissions.xml` - Publisher permissions document (plaintext)
   - Generate `example_publisher_permissions.p7s` - Signed Publisher permissions document
   - Generate `example_subscriber_permissions.xml` - Subscriber permissions document (plaintext)
   - Generate `example_subscriber_permissions.p7s` - Signed Subscriber permissions document

### 2. Generated File Structure

After running the script, the directory structure is as follows:

```
cyclonedds_security_test/
├── certs/
│   ├── example_id_ca_cert.pem          # Identity CA certificate
│   ├── example_id_ca_priv_key.pem      # Identity CA private key
│   ├── example_perm_ca_cert.pem        # Permissions CA certificate
│   ├── example_perm_ca_priv_key.pem    # Permissions CA private key
│   ├── example_publisher_cert.pem      # Publisher identity certificate
│   ├── example_publisher_priv_key.pem  # Publisher private key
│   ├── example_subscriber_cert.pem     # Subscriber identity certificate
│   └── example_subscriber_priv_key.pem # Subscriber private key
└── etc/
    ├── example_governance.xml           # Governance document (plaintext)
    ├── example_governance.p7s           # Signed governance document
    ├── example_publisher_permissions.xml    # Publisher permissions document (plaintext)
    ├── example_publisher_permissions.p7s    # Signed Publisher permissions document
    ├── example_subscriber_permissions.xml   # Subscriber permissions document (plaintext)
    └── example_subscriber_permissions.p7s   # Signed Subscriber permissions document
```

### 3. Security Configuration Details

#### Governance Configuration
- **Domain Range**: 0-230
- **Allow Unauthenticated Participants**: false
- **Enable Join Access Control**: true
- **Metadata Protection**: SIGN (signature)
- **Data Protection**: ENCRYPT (encryption)

#### Permissions Configuration
Both Publisher and Subscriber have the following permissions:
- **Domain Range**: 0-230
- **Publish Permission**: All topics (`*`)
- **Subscribe Permission**: All topics (`*`)
- **Default Rule**: DENY (reject operations not explicitly allowed)

### 4. Compile and Run

1. **Compile project**:
   ```bash
   cd /home/svf/cyclonedds_security_test
   mkdir -p build
   cd build
   cmake ..
   make
   ```

2. **Run Subscriber** (in one terminal):
   ```bash
   cd /home/svf/cyclonedds_security_test/build/bin
   ./SecuritySubscriber
   ```

3. **Run Publisher** (in another terminal):
   ```bash
   cd /home/svf/cyclonedds_security_test/build/bin
   ./SecurityPublisher
   ```

### 5. Security Configuration in Code

The security configuration in code is enabled by setting the `CYCLONEDDS_URI` environment variable, using XML format configuration:

- **Authentication**: Uses Identity CA and respective private keys/certificates
- **Cryptographic**: Uses DDS security cryptographic library
- **AccessControl**: Uses Permissions CA and signed governance/permissions documents

### 6. Verify Security Features

When the program runs, you should see:
- Publisher and Subscriber successfully establish secure connections
- Message transmission uses encryption (ENCRYPT)
- Metadata is protected with signatures (SIGN)
- Access control is verified according to permissions documents

### 7. Notes

- All certificates are valid for 10 years (3650 days)
- Permissions documents are valid for 100 years (2020-2120)
- Private key files should be kept secure and not leaked
- In production environments, stricter permissions configurations should be used

## Reference Documentation

- [Cyclone DDS Security Configuration Example](https://cyclonedds.io/docs/cyclonedds/latest/security/example_configuration.html)
- [DDS Security Specification](https://www.omg.org/spec/DDS-SECURITY/)
