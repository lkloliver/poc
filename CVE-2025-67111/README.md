# RTPS POC Test

This directory contains a simple OpenDDS publisher/subscriber example using RTPS discovery, along with a POC attacker that can send malicious RTPS packets.

## Prerequisites

Before building and running this POC, you need to install OpenDDS and ACE_wrappers.

### Installing ACE_wrappers

1. Download ACE+TAO release from GitHub:
```bash
wget https://github.com/DOCGroup/ACE_TAO/releases/download/ACE%2BTAO-8_0_5/ACE+TAO-8.0.5.tar.gz
tar -xzf ACE+TAO-8.0.5.tar.gz
cd ACE_wrappers
```

2. Configure and build:
```bash
export ACE_ROOT=$(pwd)
export LD_LIBRARY_PATH=$ACE_ROOT/lib:$LD_LIBRARY_PATH
./configure
make
```

3. Build TAO (if needed):
```bash
cd ../TAO
export TAO_ROOT=$(pwd)
make
```

### Installing OpenDDS

1. Download OpenDDS source code:
```bash
git clone https://github.com/objectcomputing/OpenDDS.git
cd OpenDDS
```

2. Configure environment variables:
```bash
export ACE_ROOT=/path/to/ACE_wrappers
export TAO_ROOT=/path/to/ACE_TAO/TAO
export DDS_ROOT=$(pwd)
export LD_LIBRARY_PATH=$ACE_ROOT/lib:$TAO_ROOT/lib:$DDS_ROOT/lib:$LD_LIBRARY_PATH
```

3. Configure and build:
```bash
./configure
make
```

## Files

- `Message.idl` - IDL definition for HelloWorld message
- `Publisher.cpp` - Simple publisher using RTPS discovery
- `Subscriber.cpp` - Simple subscriber using RTPS discovery
- `POCAttacker.cpp/h` - POC attacker that listens for GUIDs and sends malicious packets
- `POCAttackerMain.cpp` - Main entry point for POC attacker
- `Boilerplate.cpp/h` - Common boilerplate code for RTPS setup
- `DataReaderListenerImpl.cpp/h` - DataReader listener implementation
- `RTPS_POC_Test.mpc` - MPC build configuration

## Building

From the RTPS_POC_Test directory:

```bash
cd ./DCPS/CVE-2025-67111
mwc.pl -type gnuace RTPS_POC_Test.mwc
make clean
make no_opendds_safety_profile=1
```

This will generate the Makefiles and build all three executables:
- `publisher` - The normal publisher
- `subscriber` - The normal subscriber  
- `poc_attacker` - The POC attacker that sends malicious packets

## Running
### 1. Start the POC Attacker 

```bash
./poc_attacker
```
### 2. Start the Subscriber (in another terminal)

```bash
./subscriber -DCPSConfigFile rtps.ini
```

### 3. Start the Publisher (in another terminal)

```bash
./publisher -DCPSConfigFile rtps.ini
```

The publisher will send messages to the subscriber using RTPS discovery.

The POC attacker will:
1. Listen  for RTPS discovery packets
2. Extract GUIDs from discovered participants
3. Generate and send malicious DATA_FRAG packets with underflow vulnerabilities
4. Send packets to port subscriber


## Notes

- The POC attacker listens for 30 seconds to discover GUIDs
- If no GUIDs are discovered, it sends packets with a default GUID
- The malicious packets are designed to trigger integer underflow vulnerabilities in the RTPS receive path

